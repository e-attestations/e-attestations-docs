---
id: description
title: Description
sidebar_label: Description
---

<div class="banner">

```textmate
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                                                                                         ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì.     ‚ïë
‚ïë  e-Attestations.com Copyright (c) - RESTRICTED                                          ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì.      ‚ïë
‚ïë  All right reserved/Tous droits r√©serv√©s                                                ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì,       ‚ïë
‚ïë                  _   _            _        _   _                                        ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì,     ‚ñì  ‚ïë
‚ïë             /\  | | | |          | |      | | (@)                                       ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì.     ‚ñì‚ñì  ‚ïë
‚ïë  ___       /  \ | |_| |_ ___  ___| |_ __ _| |_ _  ___  _ __  ___   ___ ___  _ __ ___    ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì,      ‚ñì‚ñì‚ñì  ‚ïë
‚ïë / _ \  __ / /\ \| __| __/ _ \/ __| __/ _` | __| |/ _ \| '_ \/ __| / __/ _ \| '_ ` _ \   ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì,     .‚ñì‚ñì‚ñì‚ñì  ‚ïë
‚ïë|  __//__ / ____ \ |_| ||  __/\__ \ || (_| | |_| | (_) | | | \__ \| (_| (_) | | | | | |   .‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì.     ,‚ñì‚ñì‚ñì‚ñì‚ñì  ‚ïë
‚ïë \___/   /_/    \_\__|\__\___||___/\__\__,_|\__|_|\___/|_| |_|___(_)___\___/|_| |_| |_|      .‚ñì‚ñì‚ñì‚ñì‚ñì      ,‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì  ‚ïë
‚ïë                                                                                                .,      .‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì  ‚ïë
‚ïë                                                                                         ‚ñì,           ,‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì  ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
:: e-Attestations.com (https://www.e-attestations.com) :: REST API :: ‚òÖ‚òÖ‚òÖ‚òÖ üòé
```

</div>

# Documentation

L'API REST/Json e-Attestations est utilis√©e pour **interfacer** un syst√®me d'information '**client**' √† la plate-forme d'e-Attestations suivant le protocole HTTP.

[REST](https://en.wikipedia.org/wiki/Representational_state_transfer) (Representational State Transfer) ou RESTful est un style d'architecture permettant de construire des applications (Web, Intranet, Web Service) en exploitant des points terminateurs (des endpoints urls) et r√©f√©ren√ßant des ressources √† exploiter suivant les verbes du protocole HTTP (GET, POST, PUT, DELETE etc...).

Notre API contient des URL pr√©visibles orient√©es ressources, accepte les corps de requ√™te cod√©s au format [JSON](https://en.wikipedia.org/wiki/JSON), renvoie les r√©ponses cod√©es [JSON](https://en.wikipedia.org/wiki/JSON) et utilise les codes de r√©ponse HTTP standard, l'authentification et les verbes.

Les applications 'clientes' utilisant l'API REST e-Attestations enrichisent le Syst√®me d'Information du client avec le catalogue des donn√©es et services d'e-Attestations de fa√ßon s√©curis√©e et tr√®s souple.

L'API peut √©galement √™tre utilis√©e par les int√©grateurs, √©diteurs logiciels, des solutions SAAS ou des connecteurs.

<aside className="success">
L'API REST/Json e-Attestations est actuellement en V1.1 et est propos√©e √† l'ensemble des partenaires et clients e-Attestations.
Contactez e-Attestations pour plus d'information √† <a href="mailto:contact@e-attestations.com">contact@e-attestations.com</a>
</aside>

## Objectifs de cette documentation

* Donner des √©l√©ments de r√©ponses sur la s√©curit√© des environnements mis √† disposition
* Expliciter la mise en place et le support de l'API
* Pr√©senter les sources documentaires en ligne.
* D√©crire chaque ressources et chaque endpoint, les mod√®les associ√©s et les erreurs li√©es
* Proposer des snippets de codes pour faciliter l'int√©gration de l'API

## Documentations en ligne

Au del√† de la pr√©sente documentation nous avons apport√© un soin tout pariculier a vous offrir le plus de choix posssible concernant la documentation.

La documentation est bas√©e sur le standard Open API v3 (Swagger UI), disponible [ici](https://rs.dev-e-attestations.com/doc/swagger.yml).

&nbsp;| URL (suivant l'environnement)
----|-----------------------------------------------------------------------------------
Documentation HTML | [https://rs.dev-e-attestations.com/redoc.html](https://rs.dev-e-attestations.com/redoc.html)
OpenAPI v3 (yaml)| [https://rs.dev-e-attestations.com/doc/swagger.yml](https://rs.dev-e-attestations.com/doc/swagger.yml)

## Collection Postman

> Exemple d'utilisation de newman

```shell
npx newman run "EA_API_REST.postman_collection.json" \
  --global-var username="<user>" \
  --global-var password="<password>" \
  --global-var server_url="https://rs.dev-e-attestations.com"
```

Pour aller encore plus vite et faciliter l'int√©gration et l'exploration de notre API nous fournissons <a href="https://raw.githubusercontent.com/e-attestations/ea-api-rest-postman/master/eAttestations-API-REST-multi-version.postman_collection.json">une collection Postman</a> que vous pouvez importer dans postman et tester rapidement.

Vous devrez d√©finir quelques variables (user, password et server_url) pour exploiter cette suite de test.

Vous pouvez aussi explorer chacun des scenarios pour foncionnellement comprendre l'usage possible de l'API.

Vous pouvez t√©l√©charger Postman via <a href="https://www.getpostman.com/downloads/">ce lien</a> ou utiliser newman via <a href="https://github.com/postmanlabs/newman">ce lien</a>.

# Mise en place

Pour souscrire √† l'un ou l'autre des environnements vous devez tout d'abord en **√©mettre la demande aupr√®s de votre gestionnaire de compte** e-Attestations habituel.

Nous vous conseillons de bien discuter de la configuration de votre compte concernant les documents de compliance avec votre gestionnaire de compte afin de parfaitement comprendre votre cas d'usage et vous conseiller au mieux.

**Attention** : L'usage de l'API n'est pas multicomptes !

Votre gestionnaire de compte informera l'√©quipe technique pour la cr√©ation d'une organisation li√©e √† votre compte et un ou plusieurs contacts techniques (emails) seront alors invit√©s au **Tech'Desk e-Attestations**.

# Le support TechDesk e-Attestations

C'est un syst√®me de ticketing et de support **TECHNIQUE** d√©di√© aux API e-Attestations dans lequel vous pouvez poster questions et demandes au experts techniques e-Attestations.

Apr√®s avoir re√ßu votre email d'invitation, cr√©ez votre user et mot de passe en toute autonomie pour acc√©der aux services et documentation de cette plateforme de support.

Visitez la plateforme Tech'Desk : [https://jira-e-attestations.atlassian.net/servicedesk/customer/portals](https://jira-e-attestations.atlassian.net/servicedesk/customer/portals).

Cette plateforme s√©curis√©e vous permet aussi de partager dans votre organisation (avec tous les utilisateurs inscrits au tech'Desk) les tickets de support, les r√©ponses commentaires, extraits de codes, captures d'√©crans...

**Rappel** : les identifiant (users et mots de passe) de connexion aux APIs ne sont fournis que dans le Tech'Desk !

<a href="https://jira-e-attestations.atlassian.net/servicedesk/customer/portals" title="Acc√©dez au Tech'Desk" target="_blank">
<img class="imglink" alt="Home page du Tech'Desk e-Attestations" src="/doc/images/TechDesk_Home.png" width="70%"/>
</a>

# Environnements


e-Attestations met √† disposition deux environnements :

- **TEST** :
L'ouverture d'un acc√®s de TEST de type API REST connect√© √† un compte client de TEST vous permettra, de fa√ßon pleinement s√©curis√©e, d'acc√©der √† une infrastructure s√©curis√©e, semblable √† celle de production mais avec une base de donn√©es unique et la garantie que **les emails ne seront jamais exp√©di√©s**.

- **PRODUCTION** :
L'ouverture d'un acc√®s de PROD de type API REST connect√© √† un compte client de PROD vous permet de l'utiliser pour votre compte.

Environnement | URL
--------------|-------
TEST | [https://rs.dev-e-attestations.com/api/v1/](https://rs.dev-e-attestations.com/api/v1/)
PRODUCTION | [https://rs.e-attestations.com/api/v1/](https://rs.e-attestations.com/api/v1/)

<aside className="warning">
L'acc√®s aux environnements est autoris√© apr√®s demande aupr√®s d'e-Attestations.com.
L'obtention d'un user/mot de passe se fait de fa√ßon s√©curis√©e grace exclusivement via le tech'Desk.
Merci d'adresser vos demandes de user et mot de passe via ce biais uniquement (aucune partage de mot de passe par email).
</aside>

<aside className="notice">
Dans l'environnement de TEST les envois d'emails sont inhib√©s (pas d'invitation des tiers ou d'envoi de rapport) afin d'√©viter que vos tests n'interf√®rent pas avec votre activit√© de production.
</aside>

# Format des r√©ponses

> Exemple de r√©ponse

    ```json
    {
      content: [
        {
          "companyIdValue": "1234567890"
        }],
      messages: {
        warning: [
          {
            code: "E001",
            message: "Param√®tre manquant"
          }
        ]
      }
    }
    ```

Les r√©ponses sont au format JSON compos√©es des attributs optionnels suivants:

- **content**, contenant le r√©sultat de l'op√©ration, en cas de succ√®s.
- **messages** contenant **d'√©ventuels messages** d'information, d'avertissement ou d'erreur.
- **page**, le num√©ro de la page. **Renvoy√© en cas de contenu pagin√©.**
- **size**, taille de la page. **Renvoy√© en cas de contenu pagin√©.**
- **totalElements**, le nombre total d'√©l√©ments. **Renvoy√© en cas de contenu pagin√©.**

Pour plus de d√©tails lisez la section <a href="#schemas">Schemas</a> et plus sp√©cifiquement sur le format des <a href="#tocSmessages">Messages</a>.

> Exemple d'erreur HTTP

```json
{
    "timestamp": "2019-02-05T09:06:15.245+0000",
    "status": 404,
    "error": "Not Found",
    "message": "No message available",
    "path": "/api/v1/account/1234567/876543"
}
```

Nous avons d√©velopp√© un contrat d'interface (pr√©sent√© ci dessus) qui se veut le plus pratique pour le d√©veloppeur.

Si toute fois le protocole HTTP rencontre un d√©faut c'est code d'erreur HTTP et un contenu de message qui sera renvoy√©.

## Encoding

L'API REST doit √™tre utilis√©e et consomm√©e en UTF-8.

# S√©curit√©

## OpenID Connect (OIDC)

L'API REST e-Attestations utilise **[OpenID Connect (OIDC)](https://openid.net/connect/)** pour identifier et authentifier les clients. Toute requ√™te vers l'API doit obligatoirement inclure un Token [ (Json Web Token)](https://jwt.io/) valide.

Ce dernier doit √™tre envoy√© dans le header 'Authorization' (cf. l'exemple qui suit).

Si l'header n'est pas renseigner la requ√™te sera consid√©r√©e comme non authentifi√©e (HTTP code 401).

Plus d'informations sur OpenID Connect et JWT sur :

* [https://openid.net/connect/](https://openid.net/connect/)
* [https://jwt.io/](https://jwt.io/)


## Authorization

<!-- ReDoc-Inject: <security-definitions> -->


## Obtenir un JSON Web Token

> Obtenir un JWT

```shell
curl -X POST \
  https://auth.dev-e-attestations.com/auth/realms/eat_realm/protocol/openid-connect/token \
  -H 'Content-Type: application/x-www-form-urlencoded' \
  -H 'cache-control: no-cache' \
  -d 'client_id=ea-api-edge' \
  -d 'username=<username>' \
  -d 'password=<password>' \
  -d 'grant_type=password'
```

L'obtention d'un token JWT repose sur l'envoi d'un requ√™te de type POST avec transmission des user, mot de passe et quelques param√®tres compl√©mentaires au serveur d'authentification.

Vous devez transmettre une requete au format 'application/x-www-form-urlencoded' et portant les param√®tres suivantes (tous obligatoires) :

- **client_id** : 'ea-api-edge', le nom de l'API.
- **grant_type** : 'password', le mode d'authentification.
- **username** : nom de votre utilisateur API
- **password** : mot de passe de votre utilisateur d'API

Le serveur d'authentification renverra un mot JSON dans lequel il faut pr√©server 'access_token'.



<div class="mermaid">sequenceDiagram
  participant Client
  participant API_Server
  participant Authorizer
  Client->Authorizer: Get Token
  loop get token
      Authorizer->Authorizer: Verify credentials (renew JWT)
  end
  Authorizer-->Client: Retrieve JWT
  Client->API_Server: Request + Authorization Bearer
  Note right of API_Server: Check JWT and subscription
  API_Server-->Client: Response
</div>



Ce token est temporaire et vous devrez en obtenir un nouveau d√®s qu'il sera p√©rim√©.

> R√©ponse

```json
{
    "access_token":"eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICI0V19kYjFzUmpISTc3SGc0SkRWclVLQXpaQlBnZjlpY2ZDcU5vQUxOZWhNIn0.eyJqdGkiOiI0ZGExNjE1NC04ZjQyLTQyNzQtOTM4Ny0wOGJiODk4MmE3MTMiLCJleHAiOjE1NTQyOTgyNTgsIm5iZiI6MCwiaWF0IjoxNTU0Mjk2NDU4LCJpc3MiOiJodHRwczovL2F1dGguZGV2LWUtYXR0ZXN0YXRpb25zLmNvbS9hdXRoL3JlYWxtcy9lYXRfcmVhbG0iLCJhdWQiOiJhY2NvdW50Iiwic3ViIjoiYzg0OGFiYmItYTIyOC00MmMxLWFkNzAtYjJiMDEwYzhlODUxIiwidHlwIjoiQmVhcmVyIiwiYXpwIjoiZWEtYXBpLWVkZ2UiLCJhdXRoX3RpbWUiOjAsInNlc3Npb25fc3RhdGUiOiI5YmEzYWFmNC0zYjU0LTQ5ZTctOTJiMC0xOTkwMGQxNWE5ZWIiLCJhY3IiOqsdqsdsdqsdqsdsaW5lX2FjY2VzcyIsInVtYV9hdXRob3JpemF0aW9uIiwiQURNSU4iLCJVU0VSIl19LCJyZXNvdXJjZV9hY2Nlc3MiOnsiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJwcm9maWxlIGVtYWlsIiwiYWNjb3VudF9pZHMiOiIxMTg0NjYiLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwibmFtZSI6IlZpbmNlbnQgREFHT1VSWSIsInByZWZlcnJlZF91c2VybmFtZSI6InYuZGFnb3VyeUBlLWF0dGVzdGF0aW9ucy5jb20iLCJnaXZlbl9uYW1lIjoiVmluY2VudCIsImZhbWlseV9uYW1lIjoiREFHT1VSWSIsImVtYWlsIjoidi5kYWdvdXJ5QGUtYXR0ZXN0YXRpb25zLmNvbSJ9.c-smWPif1YT9dKicAAJSsNwI-xCtZWV-r6QqYFSvkgHhPsgHc0gDLenMfQBgYPN_0jKW7FBJmse7fgAB4dnrqCOGM33cQ2wfYi37aXlDqz8l_aFamkEslGnKxw9QDOYSMQz52dD34yXQZGl0OxXE01PAquqKUEtnVG0Rz2SAB0qU5tAqsdqsdsd-rKpCYwKb_6-WwH2xN1B9lgLahZexprPvH25OXUcPJ0GSXCASpnSMxR3ziiv9AtX3R48rT4T_LTLlrKblT_cdZS-Z_uGgzP0pxT9yfqxSYn05haRLTL_grBDdt31ZIDnxiMFEg2UdDB1wzlJBOuOEmw",
    "expires_in": 1800,
    "refresh_expires_in": 1800,
    "refresh_token":"eyJhbGciOiJIUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJiYTcxZWMyOC0wOTVkLTRkOWQtOWQwYi1jYjAyMTJmNjczYjcifQ.eyJqdGkiOiI2YmQ2ZThkYS1kOWNjLTRhNzgtODg1NS1iMzMwZWU0NDg1NjEiLCJleHAiOjE1NTQyOTgyNTgsIm5iZiI6MCwiaWF0IjoxNTU0Mjk2NDUqsdqsdqsdqsdOiJodHRwczovL2F1dGguZGV2LWUtYXR0ZXN0YXRpb25zLmNvbS9hdXRoL3JlYWxtcy9lYXRfcmVhbG0iLCJhdWQiOiJodHRwczovL2F1dGguZGV2LWUtYXR0ZXN0YXRpb25zLmNvbS9hdXRoL3JlYWxtcy9lYXRfcmVhbG0iLCJzdWIiOiJjODQ4YWJiYi1hMjI4LTQyYzEtYWQ3MC1iMmIwMTBjOGU4NTEiLCJ0eXAiOiJSZWZyZXNoIiwiYXpwIjoiZWEtYXBpLWVkZ2UiLCJhdXRoX3RpbWUiOjAsInNlc3Npb25fc3RhdGUiOiI5YmqsdqsdsqsdQ5ZTctOTJiMC0xOTkwMGQxNWE5ZWIiLCJyZWFsbV9hY2Nlc3MiOnsicm9sZXMiOlsib2ZmbGluZV9hY2Nlc3MiLCJ1bWFfYXV0aG9yaXphdGlvbiIsIkFETUlOIiwiVVNFUiJdfSwicmVzb3VyY2VfYWNjZXNzIjp7ImFjY291bnQiOnsicm9sZXMiOlsibWFuYWdlLWFjY291bnQiLCJtYW5hZ2UtYWNjb3VudC1saW5rcyIsInZpZXctcHJvZmlsZSJdfX0sInNjb3BlIjoicHJvZmlsZSBlbWFpbCJ9.fpVVA-G-Fj9MDOB5ZneAGVRhkLk26hgCeZ4dqh3rEHs",
    "token_type": "bearer",
    "not-before-policy": 1550670103,
    "session_state": "9ba3aaf4-3b54-49e7-92b0-19900d15a9eb",
    "scope": "profile email"
}
```
## URLs d'authentification

Pour chaque environnement, une URL sp√©cifique vous permet de r√©cup√©rer le JWT :

- Non PRODUCTION : ```https://auth.dev-e-attestations.com/auth/realms/eat_realm/protocol/openid-connect/token```
- PRODUCTION : ```https://auth.e-attestations.com/auth/realms/eat_realm/protocol/openid-connect/token```


## Utilisation du JSON Web Token

<aside className="warning">
La dur√©e de validit√© du tocken est de quelques minutes. Vous devez vous assurer de la dur√©e de validit√© de votre TOKEN grace √† la donn√©e "expires_in" qui vous indique en nombre de secondes avant qu'il n'expire au moment de son obtention (par exemple 1800 secondes correspondant √† 30').
</aside>

Le Json Web TOKEN (JWT) est √† utiliser dans tous les requetes vers l'API suivantes est la valeur du token √©tant renvoy√© dans la propri√©t√© **"access_token"**.

Il doit √™tre plac√© dans la request, dans un Header sous la forme :

```
Authorization: Bearer TOKEN
```

> Utilisation du JWT

```shell
curl -X GET \
  https://api.e-attestations.com/v4/account/97862/dossiers \
    -H "Authorization: Bearer <JWT_TOKEN>"
```

<aside className="notice">
Vos identifiants sont d√©livr√©s √† votre demande <strong>UNIQUEMENT</strong> via un ticket envoy√© au <a href="#le-support-tech-39-desk-e-Attestations">Tech'Desk</a> et apr√®s activation de votre souscription par votre gestionnaire de comptes.
</aside>

# Ressources

## Compte (account)

> Exemple de contenu de '/account'

```json
{
   "content": [
       {
           "id": 119631,
           "creation": "2015-04-02T10:56:07.736",
           "account": "CPTDO2E2FFC774EDD6637F",
           "name": "Compte Test",
           "company": "Compte Test",
           "maxDossiers": 10,
           "subscriptionDate": "2019-04-29T13:20:02.102973",
           "subscriptionStatus": "ACTIVE",
           "subscriptions": [
               {
                   "accountId": 119631,
                   "key": "APIEDGE",
                   "endSubscriptionDate": null,
                   "startSubscriptionDate": "2019-04-29T13:20:02.102973",
                   "status": "ACTIVE"
               }
           ]
       }
   ]
}
```

Le compte e-Attestations donneur d'ordres et souscripteur au service.

Chaque compte dispose d'un identifiant de **compte unique** avec un identifiant.

Par construction, toutes les requ√™tes doivent obligatoirement inclure l'identifiant du client dans l'URL d'appel √† l'exception du point terminateur **/account** qui vous donnes des informations sur votre l'identifiant du compte.

Les urls sont ainsi toutes prefix√©es par **/account/{account_id}/****

<aside className="notice">
Vous pouvez m√©moriser dans votre jeux de configuration votre identifiant de compte ou choisir de le r√©cup√©rer dynamiquement.
Cette derni√®re solution √©tant la plus souple.
</aside>

L'identifiant de compte (de type string) est renvoy√© dans le **payload** du token JWT, comme illustr√© ci-dessous:

De fa√ßon compl√©mentaire vous pouvez r√©cup√©rer votre identifiant de compte via l'url **/account** (sans aucun param√®tre).

Les donn√©es du TOKEN seront utilis√©es pour restituer et v√©rifier votre compte et la souscription au service.

Des informations compl√©mentaires sur votre souscription au service sont aussi restitu√©es.

## Tiers (thirdparties)

Le tiers, le fournisseur, le sous-traitant, etc... est en relation avec le compte donneur d'ordres et fait l'objet de l'√©valuation continue au titre de sa conformit√©, suivant la souscription et/ou les option du compte e-Attestations.

Dans le cadre de cette relation, le compte e-Attestations utilisateur de l'API REST/JSON est aussi appel√© compte "donneur d'ordres".

> Exemple d'appel GET sur "/api/v1/account/{{account_id}}/thirdparties?siret=50382936800045"

```json
{
    "content": [
        {
            "thirdpartyId": 875,
            "companyIdType": "CIT001",
            "companyIdValue": "50382936800045",
            "thirdpartyCode": "123",
            "siren": "503829368",
            "siret": "50382936800045",
            "tva": "FR69503829368",
            "name": "E-ATTESTATIONS.COM",
            "datecreation": "2010-11-24",
            "legalCategoryLabel": "Soci√©t√© par actions simplifi√©e",
            "legalCategoryCode": "5710",
            "acronym": null,
            "activityLabel": "Edition de logiciels applicatifs",
            "activityCode": "5829C",
            "ceo": "POIDEVIN Emmanuel",
            "capital": 3642000,
            "capitalCurrency": "EUR",
            "turnover": 2771996.0,
            "turnoverCurrency": "EUR",
            "lastBalanceSheetDate": "2017-12-31",
            "workforce": 13
        }
    ],
    "page": 0,
    "size": 10,
    "totalElements": 1
}
```

## Dossiers (dossiers)

Le dossier est une materialisation de la relation donneur d'ordres / tiers.
Un dossier comporte des demandes (exigences de conformit√©) formul√©es par le donneur d'ordres auxquelles correspondent des r√©ponses le plus souvent automatiquement apport√©e par le plateforme e-Attestations ou par le tiers (fichiers, signatures, autres donn√©es ...).

La r√©f√©rence d'un dossier (dossierReference) est une donn√©e renseign√©e par le donneur d'ordres lors de la cr√©ation d'un dossier ou la modification d'un dossier. La r√©f√©rence d'un dossier doit √™tre unique pour un couple tiers/donneur d'ordres. Autrement dit, un tiers ne peut avoir plus d'un dossier portant la m√™me r√©f√©rence par donneur d'ordres.

Cette r√©f√©rence de dossier peut √™tre modifi√©e √† n'importe quel moment sauf s'il le dossier a √©t√© archiv√©.

> Exemple d'interrogation au siren GET "/api/v1/account/{{account_id}}/dossiers?siren=503829368"

```json
{
    "content": [
        {
            "dossierId": 804127,
            "accountId": 119631,
            "siren": "503829368",
            "siret": "50382936800045",
            "tva": "FR69503829368",
            "thirdpartyId": 875,
            "companyIdType": "CIT001",
            "companyIdValue": "50382936800045",
            "thirdpartyCode": "123",
            "companyCountryCode": "FR",
            "monitored": true,
            "dossierReference": "TEST",
            "description": "description_804127",
            "purchasingCategory": "",
            "startingDate": null,
            "expirationDate": null,
            "stoppingDate": null,
            "stoppingReason": "NA",
            "state": false,
            "stateLastChangeDate": "2019-01-08T15:31:55.521",
            "indicators": [
                {
                    "indicatorCode": "I001",
                    "state": true,
                    "lastChangeDate": "2018-07-16T11:04:59.806"
                }
            ],
            "documents": [
                {
                    "documentId": 511394021,
                    "documentCode": "I2",
                    "name": "I2",
                    "requestDate": "2019-01-08T15:31:55.486",
                    "present": false,
                    "listFileInformation": []
                }
            ]
        }
    ],
    "page": 0,
    "size": 10,
    "totalElements": 1
}
```

## Exigences (requirements)

L'exigence est un ensemble de demande d'un domaine du donneur d'ordres (l√©gale, compliance, m√©tier, etc...). Une exigence fait l'objet d'une **demande** et en attente d'une **r√©ponse** qu'elle soit apport√©e par e-Attestations et pour le tiers lui m√™me tels qu'une donn√©e sp√©cifique, un ou plusieurs documents et leur(s) fichier(s) li√©(s), une signature ou tout autre √©l√©ment demand√© constituant un preuve de conformit√© dans le cadre du suivi.

> Exemple d'interrogation des exigences d'un dossier GET "/api/v1/account/{{account_id}}/dossiers/{{dossierId}}/requirements"

```json
{
    "content": [
        {
            "documentId": 1,
            "accountId": 119631,
            "code": "ATT_VIGI",
            "name": "Attestationdevigilance6mois",
            "dossierId": 836261
        },
        {
            "documentId": 2,
            "accountId": 119631,
            "code": "JUSTIF_IMM",
            "name": "Justificatifdimmatriculation",
            "dossierId": 836261
        }
    ]
}
```

## Documents (documents)

Les documents sont les √©l√©ments constituant la demande d'exigence de conformit√©, d√©finis en type de document (g√©n√©ralement un type de document par exigence) et pour lequel une r√©ponse est apport√©e par e-Attestations ou le tiers lui m√™me.

Un document peut √™tre une signature, une donn√©e, un ou plusieurs fichiers, un ensemble de donn√©es issues d'un formulaire √† remplir par le d√©clarant.

Un document a une validit√© et donc une p√©remption que la plateforme e-Attestations surveille en continu.

> Exemple d'obtention des documents d'un dossier GET "/api/v1/account/{{account_id}}/dossiers/{{dossierId}}/documents"

```json
{
    "content": [
        {
            "documentId": 510893525,
            "documentCode": "JUSTIF_IMM",
            "name": "JUSTIF_IMM",
            "requestDate": "2018-09-19T10:02:46.435",
            "present": true,
            "listFileInformation": [
                {
                    "fileId": 4575539,
                    "uploadDate": "2019-03-19T00:22:22.31",
                    "fileUUID": "8d76e532ec39daa965da354e72a9cfa35c43c2ab",
                    "fileCreation": "2019-03-19T00:22:22.299",
                    "fileSize": 75422,
                    "expirationDate": "2019-09-19T23:59:59.999"
                }
            ]
        },
        {
            "documentId": 510893524,
            "documentCode": "ATT_VIGI",
            "name": "ATT_VIGI",
            "requestDate": "2018-09-19T10:02:46.382",
            "present": true,
            "listFileInformation": [
                {
                    "fileId": 4224544,
                    "uploadDate": "2018-10-30T08:57:17.765",
                    "fileUUID": "22945cf9490f46396fb2f6e6bf716d383836cb9f",
                    "fileCreation": "2018-10-30T08:57:17.759",
                    "fileSize": 73927,
                    "expirationDate": "2019-03-31T23:59:59.999"
                }
            ]
        }
    ]
}
```

## Fichiers (files)

Les fichiers attach√©s aux documents d'exigence de conformit√© sont majoritairement des PDF.

> Exemple d'obtention des fichiers d'un document d'un dossier GET "/api/v1/account/{{account_id}}/dossiers/{{dossierId}}/documents/{{documentId}}/files"

```json
{
    "content": [
        {
            "fileId": 4575539,
            "uploadDate": "2019-03-19T00:22:22.31",
            "fileUUID": "8d76e532ec39daa965da354e72a9cfa35c43c2ab",
            "fileCreation": "2019-03-19T00:22:22.299",
            "fileSize": 75422,
            "expirationDate": "2019-09-19T23:59:59.999"
        }
    ]
}
```

# Comment cr√©er un dossier de suivi ?

> Cr√©ation d'un dossier

```
curl --request POST \
  --url https://rs.dev-e-attestations.com/api/v1/account/119631/dossiers \
  --header 'Authorization: Bearer {{token}}' \
  --header 'Content-Type: application/json' \
  --data '{\n  "companyIdType": "CIT001",\n  "companyIdValue": "50382936800045",\n  "thirdpartyCode": "",\n  "dossierReference": "DOSSIER_REST_9",\n  "description": "Dossier #5 de test import√© depuis l'\''API REST",\n  "purchasingCategory": "",\n  "expirationDate": "2020-05-31",\n  "requiredDocuments": [ "JUSTIF_IMM" ],\n  "thirdpartyEmail": ["v.dagoury@e-attestations.com"],\n  "userInCharge": [\n    "v.dagoury@e-attestations.com"\n  ]\n}'
```

La cr√©ation de dossier de suivi de la conformit√© des tiers est au coeur du processus de recrutement d'un tiers pour lequel vous souhaitez suivre la conformit√© et la principale √©tape permettant de d√©marrer le processus de suivi.

<aside className="success">
La conformit√© √† exiger d√©pend de votre besoin de la nature de votre tiers, du march√©, de param√®tres exog√®nes...
<strong>Votre gestionnaire de compte e-Attestations est l√† pour vous conseiller.</strong>
</aside>

Elle est aussi la phase de recrutement de votre tiers qui sera alors inform√© par email qu'un dossier de suivi est encours.

Un workflow continu d√©marre alors pour le tiers qui devra alors d√©poser les preuves exig√©es par votre dossier.

Lors de la cr√©ation d'un dossier le workflow d√©clench√© est asynchrone et se d√©crit ainsi :

- la r√©cup√©ration automatique des donn√©es du tiers (y compris s'il n'est pas d√©j√† dans la base e-Attestations)
- son invitation gr√¢ce √† l'email de contact
- **√©ventuellement** l'envoi d'emails de demande pour les documents ou preuves demand√©s et non d√©j√† pr√©sents
- la production d'un indicateur de compl√©tude ('I001') repr√©sentant la bonne sant√© du suivi au regard de l'exigence du dossier de suivi

Mais aussi :

- des rappels r√©guliers par email envoy√©s aux tiers
- la mise √† jour des donn√©es r√©guli√®rement et sur √©v√©nement
- la production d'indicateurs complexes
- du reporting
- des diagnositiques
- du conseil et l'expertise e-Attestations

Le endpoint **POST /account/{accountId}/dossiers** permet de cr√©er un dossier de suivi continu de la conformit√© pour un tiers (thirdparty).

**Vous trouverez toutes les informations compl√©mentaire sur ce endpoint dans la section <a href="#importer-un-dossier">Importer un dossier</a>.**

Le traitement pouvant durer plusieurs minutes la r√©ponse est **asynchrone**, comme illustr√© dans le sch√©ma ci-dessous.

Lors de la cr√©ation un identifiant de suivi du traitement de l'import (processId) est renvoy√©.
Il vous faudra l'utiliser pour conna√Ætre le r√©sultat de l'import de fa√ßon asynchrone.

Le endpoint **GET /account/{accountId}/dossier/process/{processId}** permet de suivre le r√©sultat de l'import gr√¢ce √† l'identifiant du process d'import renvoy√© lors de l'appel "Cr√©ation d'un dossier" (POST /account/{accountId}/dossiers).

<p class="mermaid">
graph TB
  A((Start))
  A --> B(Call Import dossier endpoint, returns processId)
  B --processId--> C(Call Get import result endpoint for processId)
  C --> D{Status}
  D --complete=true AND success=true--> E
  D --complete=true ANDsuccess=false--> R
  D --complete=false--> C
  E((End))
  R(Error Handling)
</p>

> Il est important de bien v√©rifier les param√®tres d'appel et de bien prendre en compte les codes d'erreurs et leur signification.

# Codes et nomenclatures

## Identifiant de compagnie

Un √©tablissement ou une entreprise (au sens personne morale) est indentifi√©e dans le syst√®me e-Attestations √† l'aide d'un code identifiant national (SIRET, SIREN pour la France) ou d'un num√©ro internationnal (ex. l'identifiant TVA).

l'API e-Attestations propose deux types d'identifiants :

Type                         | Description
-----------------------------|---------------------------------------
CIT001                       | SIRET : identifiant utilis√© en France pour qualifier les √©tablissements. Nombre de 14 chiffres v√©rifiant l'algorithme de Luhn [Wikipedia](https://fr.wikipedia.org/wiki/Formule_de_Luhn)
CIT002                       | Num√©ro TVA : identifiant utilis√© par la CEE pour les entreprises soumises √† l'imp√¥t sur les soci√©t√©s. Plus d'informations sur [Wikipedia](https://en.wikipedia.org/wiki/VAT_identification_number)

Des types d'identifiants nouveaux pourront √™tre impl√©ment√© au fil des √©volutions de l'API.

## Indicateur de compl√©tude

L'indicateur de compl√©tude e-Attestations permet de renseigner de fa√ßon simple que le tiers a couvert enti√®rement les besoins ('requirements') au titre de la conformit√© exig√©e par la compliance client.

Exemple : un dossier de surveillance d'un tiers est jug√© complet pour l'indicateur "obligation de vigilance", si tous les documents relatifs √† l'obligation de vigilance sont pr√©sents et valid√©s.

Code indicateur| Description
---------------|------------------------
I001           | Obligation de vigilance

## Codes d'erreur

Le cas √©ch√©ant, des codes erreurs sont renvoy√©es lors de certaines actions et notamment :

- lors de la cr√©ation d'un dossier
- lors d'une recherche de dossier
- lors de la mise √† jour d'un dossier

Ces erreurs ont une nomenclature (code et description) qu'il faut prendre en compte pour les interpr√©ter.

Codes          | Erreurs de recherche
---------------|------------------------------------------
E001           | Param√®tre manquant
E002           | Param√®tre inconnu
E003           | Param√®tre vide
E010           | Format incorrect
E011           | Taille maximale d√©pass√©e
E021           | Date d'expiration dans le pass√©
E022           | Date dans le futur
E030           | Domaine de l‚Äôe-mail invalide

Codes          | Erreurs lors de la cr√©ation d'un dossier
---------------|------------------------------------------
E101           | Erreur lors de la qualification de l'√©tablissement
E102           | L'√©tablissement n'existe pas.
E103           | L'√©tablissement est ferm√©.
E112           | Le code fournisseur (thirdpartyCode) d√©j√† utilis√© pour un autre fournisseur.
E113           | Compte donneur d'ordres non actif

Codes          | Erreurs lors de la mise √† jour d'un dossier
---------------|---------------------------------------------
E201           | Le dossier est d√©sactiv√©
E202           | La r√©f√©rence du dossier existe d√©j√† pour ce couple donneur d'ordres / Fournisseur
E301           | Le document (requirement) est d√©sactiv√©
E302           | Le document (requirement) n'est pas autoris√©
